# たまっぷ (Vite+React+TypeScript)

法政大学多摩キャンパスの学生向けに、大学と最寄り駅（西八王子・めじろ台・相原）を結ぶバスの時刻表をリアルタイムで提供するWebアプリケーションです。

## 特徴

- **リアルタイム時刻表示**: 現在時刻に基づき、次のバスの発車時刻、主要バス停への到着時刻を自動で表示します。
- **双方向対応**: 「大学行き」「駅行き」の双方向の時刻表に対応し、簡単に切り替えが可能です。
- **学部棟への到着時刻**: 各学部棟（経済学部、社会学部、スポーツ健康学部など）への到着予測時刻も表示します。
- **Jamstack構成**: Vite + Reactでビルドされた静的ファイルを配信するため、高速な表示と高いアクセス耐性を実現しています。
- **レスポンシブデザイン**: PC、スマートフォン、タブレットなど、あらゆるデバイスで快適に利用できます。

## 使用技術

- **フレームワーク**: React 19
- **ビルドツール**: Vite
- **言語**: TypeScript
- **ルーティング**: React Router DOM
- **スタイリング**: Tailwind CSS, shadcn/ui
- **アニメーション**: GSAP (GreenSock Animation Platform)
- **SEO対策**: React Helmet Async
- **型検証**: Zod

## ファイル構成

```
/
├── public/ # アイコンや画像などの静的ファイル
├── src/
│   ├── components/ # 再利用可能なUIコンポーネント
│   │   ├── ui/ # shadcn/uiから提供される基本コンポーネント
│   │   └── ...
│   ├── pages/ # 各ページのコンポーネント
│   │   ├── discount/ # 提携店舗の割引情報ページ
│   │   └── home.tsx # トップページ
│   ├── utils/ # アプリケーション全体で使用するユーティリティ関数・データ
│   │   ├── timeHandlers.ts # 時刻関連の主要ロジック
│   │   ├── Timetable.json # バスの時刻表データ
│   │   ├── Holidays.json # 祝日データ
│   │   └── ekitan.json # 電車の時刻表データ
│   ├── App.tsx # アプリケーションのメインコンポーネント（ルーティング設定）
│   └── main.tsx # アプリケーションのエントリーポイント
├── package.json
└── README.md
```

## 時刻情報の処理

本アプリケーションのコア機能である時刻情報の処理は、`src/utils/`内のファイル群によって実現されています。

### 1. データソース (JSONファイル)

- **`Timetable.json`**
  - アプリケーションのメインとなるバスの時刻表データです。
  - 神奈川中央交通（神奈中バス）および京王バスの公式サイトから取得した情報を基に作成されています。
  - 各バスの便は以下の情報を持つオブジェクトとして定義されています。
    - `day`: 運行曜日 (`Weekday`, `Saturday`, `Sunday`)
    - `station`: 発着駅 (`nishihachioji`, `mejirodai`, `aihara`)
    - `isComingToHosei`: 大学行きかどうかのフラグ (`true`/`false`)
    - `leaveHour`, `leaveMinute`: 出発時刻
    - `arriveHour`, `arriveMinute`: 到着時刻
    - `busStops`: 主要なバス停ごとの到着予測時刻

- **`Holidays.json`**
  - 日本の祝日を定義したデータです。
  - `YYYY-MM-DD`: `祝日名` の形式で記述されています。
  - このファイルに基づき、祝日は「休日ダイヤ」（`Sunday`扱い）として処理されます。

- **`ekitan.json`**
  - 各最寄り駅（西八王子、めじろ台、相原、橋本）の電車時刻表データです。
  - バスへの乗り換え案内機能のために使用されます。

### 2. 時刻処理ロジック (`src/utils/timeHandlers.ts`)

このファイルには、JSONデータを処理し、ユーザーに表示する情報を計算するための主要な関数が含まれています。

- **`findNextBuses(params)`**
  - アプリケーションの心臓部となる関数です。
  - 現在時刻、選択された駅、進行方向（大学行き/駅行き）などの情報を受け取り、`Timetable.json`から **直近のバス（過去2便、未来3便）** を検索して返します。
  - **主な処理の流れ**:
    1. ユーザーが選択した駅と方向に基づき、`Timetable.json`のデータをフィルタリングします。
    2. `isHoliday()`関数で現在が祝日かどうかを判定し、祝日の場合は曜日を`Sunday`として扱います。
    3. 現在時刻と比較し、直近のバスを複数便（過去・未来含む）取得します。
    4. 深夜0時を過ぎた場合でも、自動で翌日の時刻表を検索するロジックが含まれています。

- **`findNextTrains(params)`**
  - `ekitan.json`を基に、指定された駅の次の電車の発車時刻を検索します。

- **`isHoliday(params)`**
  - `Holidays.json`を参照し、与えられた日付が祝日かどうかを判定します。

## 開発環境の構築

1. Node.jsをインストールします。
2. このリポジトリをクローンします。
3. `npm install`を実行して依存関係をインストールします。
4. `npm run dev`を実行して開発サーバーを起動します。
5. ブラウザで`http://localhost:5173`にアクセスして動作を確認します。

## ビルド

`npm run build`を実行すると、`dist`フォルダにビルドされた静的ファイルが出力されます。

## デプロイ

現在利用しているロリポップサーバーでは、`dist`フォルダの中身をそのままアップロードすることで公開できます。